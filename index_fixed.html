<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NutriSeed – Calculadora de Deficiencias Nutricionales</title>
    <style>
      :root {
        --card-bg: rgba(255, 255, 255, 0.25);
        --border-color: rgba(255, 255, 255, 0.3);
        --accent-color: #f7bf2c;
        --text-color: #3d3d3c;
      }
      body {
        margin: 0; padding: 0; font-family: Arial, Helvetica, sans-serif;
        background: linear-gradient(135deg, #3d3d3c, #f7bf2c);
        display: flex; justify-content: center; align-items: center; min-height: 100vh; box-sizing: border-box;
      }
      .app-wrapper {
        backdrop-filter: blur(15px); background: var(--card-bg); border-radius: 2rem;
        border: 1px solid var(--border-color); box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        padding: 2rem; width: 100%; max-width: 600px; display: flex; flex-direction: column; box-sizing: border-box;
      }
      h1 { text-align: center; color: var(--text-color); margin-bottom: 1rem; font-size: 2rem; }
      label { display: block; margin-top: 1rem; font-weight: 600; color: var(--text-color); }
      input, select {
        width: 100%; padding: 0.6rem 0.8rem; margin-top: 0.4rem; border-radius: 0.8rem;
        border: 1px solid var(--border-color); background: rgba(255, 255, 255, 0.4); color: #333; font-size: 1rem; box-sizing: border-box;
      }
      button {
        width: 100%; padding: 0.8rem; margin-top: 1.5rem; border-radius: 1rem; border: none;
        background: linear-gradient(145deg, var(--accent-color), #3d3d3c); color: #fff; font-size: 1rem; font-weight: 600;
        cursor: pointer; transition: transform 0.1s ease;
      }
      button:active { transform: scale(0.98); }
      .result { margin-top: 1.5rem; padding: 1rem; border-radius: 1rem; background: rgba(255, 255, 255, 0.3); color: var(--text-color); display: none; line-height: 1.6; }
      .fertilizer-table { width: 100%; border-collapse: collapse; margin-top: 1rem; font-size: 0.9rem; }
      .fertilizer-table th, .fertilizer-table td { padding: 0.5rem; border: 1px solid rgba(255, 255, 255, 0.2); text-align: left; color: var(--text-color); }
      .fertilizer-table th { font-weight: bold; background: rgba(255, 255, 255, 0.2); }
      footer { margin-top: 2rem; text-align: center; color: var(--text-color); font-size: 0.9rem; }
      @media (max-width: 600px) { .app-wrapper { padding: 1.5rem; border-radius: 1.5rem; } h1 { font-size: 1.6rem; } }
    </style>
  </head>
  <body>
    <div class="app-wrapper">
      <h1>NutriSeed</h1>
      <form id="nutriForm">
        <label for="crop">Cultivo</label>
        <select id="crop" required>
          <option value="" disabled selected>Selecciona un cultivo</option>
          <option value="soja">Soja</option>
          <option value="trigo">Trigo</option>
          <option value="maiz">Maíz</option>
          <option value="girasol">Girasol</option>
          <option value="mani">Maní</option>
          <option value="cebada">Cebada</option>
          <option value="lenteja">Lenteja</option>
          <option value="arveja">Arveja</option>
          <option value="picingallo">Maíz Picingallo</option>
          <option value="algodon">Algodón</option>
        </select>
        <label for="yearType">Condición del año</label>
        <select id="yearType" required>
          <option value="" disabled selected>Selecciona una condición</option>
          <option value="seco">Seco</option>
          <option value="neutro">Neutro</option>
          <option value="humedo">Húmedo</option>
        </select>
        <label for="nVal">Análisis Nitrógeno (N)</label>
        <input type="text" id="nVal" placeholder="Ingresa N (ppm, mg/kg o unidad equivalente)" required />
        <label for="pVal">Análisis Fósforo (P)</label>
        <input type="text" id="pVal" placeholder="Ingresa P (ppm, mg/kg o unidad equivalente)" required />
        <label for="kVal">Análisis Potasio (K)</label>
        <input type="text" id="kVal" placeholder="Ingresa K (ppm, mg/kg o unidad equivalente)" required />
        <button type="submit">Calcular deficiencias</button>
      </form>
      <div id="result" class="result"></div>
      <footer>&copy; 2025 NutriSeed</footer>
    </div>
    <script>
      const baseRecommendations = {
        soja: { N: 35, P: 45, K: 100 },
        trigo: { N: 40, P: 30, K: 50 },
        maiz: { N: 60, P: 35, K: 80 },
        girasol: { N: 25, P: 40, K: 60 },
        mani: { N: 20, P: 25, K: 30 },
        cebada: { N: 35, P: 25, K: 40 },
        lenteja: { N: 20, P: 30, K: 20 },
        arveja: { N: 20, P: 35, K: 30 },
        picingallo: { N: 50, P: 30, K: 60 },
        algodon: { N: 45, P: 25, K: 70 },
      };
      const fertilizers = {
        urea: { name: 'Urea', N: 46, efficiency: 0.60 },
        uan: { name: 'UAN (Urea-Ammonium Nitrate)', N: 32, efficiency: 0.78 },
        solmix: { name: 'SolMIX', N: 28, S: 5.2, Zn: 0.5, efficiency: 0.80 },
        can: { name: 'Nitrato de amonio calcáreo (CAN)', N: 27, Ca: 9, efficiency: 0.70 },
        tsp: { name: 'Superfosfato triple (TSP)', P: 46, efficiency: 0.25 },
        ssp: { name: 'Superfosfato simple (SSP)', P: 20, S: 14, Ca: 12, efficiency: 0.20 },
        map: { name: 'Fosfato monoamónico (MAP)', N: 11, P: 52, efficiency: 0.30 },
        dap: { name: 'Fosfato diamónico (DAP)', N: 18, P: 46, efficiency: 0.30 },
        micro: { name: 'Microgranulados arrancadores', N: 8, P: 30, efficiency: 0.35 },
        an: { name: 'Nitrato de amonio (AN)', N: 34, efficiency: 0.70 },
        kcl: { name: 'Cloruro de potasio (KCl)', K: 60, efficiency: 0.50 },
      };
      const conversionFactors = { P_TO_P2O5: 2.29, P2O5_TO_P: 0.44, K_TO_K2O: 1.20, K2O_TO_K: 0.83 };
      const defaultFertilizerFor = { N: fertilizers.uan, P: fertilizers.map, K: fertilizers.kcl };
      const yearMultipliers = { seco: 1.1, neutro: 1.0, humedo: 0.9 };
      function formatNumber(v){ return Number.isFinite(v) ? v.toFixed(2) : '0.00'; }
      function calculateDeficiency(rec, actual){ const d = rec - actual; return d > 0 ? d : 0; }
      function readNumber(id){
        const raw = document.getElementById(id).value.trim().replace(',', '.').replace(/\s+/g,'');
        const val = parseFloat(raw);
        return Number.isFinite(val) ? val : NaN;
      }
      const form = document.getElementById('nutriForm');
      const resultContainer = document.getElementById('result');
      form.addEventListener('submit', function (event) {
        event.preventDefault();
        try {
          const cropKey = document.getElementById('crop').value;
          const yearKey = document.getElementById('yearType').value;
          const nVal = readNumber('nVal');
          const pVal = readNumber('pVal');
          const kVal = readNumber('kVal');
          if (!cropKey || !yearKey || !Number.isFinite(nVal) || !Number.isFinite(pVal) || !Number.isFinite(kVal)) {
            alert('Completá todos los campos con números válidos (podés usar coma o punto).');
            return;
          }
          const base = baseRecommendations[cropKey];
          const mult = yearMultipliers[yearKey];
          const recN = base.N * mult;
          const recP = base.P * mult;
          const recK = base.K * mult;
          const defN = calculateDeficiency(recN, nVal);
          const defP = calculateDeficiency(recP, pVal);
          const defK = calculateDeficiency(recK, kVal);
          function computeDose(def, key){
            if (!def || def <= 0) return 0;
            const fert = defaultFertilizerFor[key];
            if (!fert) return 0;
            let required = def;
            if (key === 'P') required = def * conversionFactors.P_TO_P2O5;
            if (key === 'K') required = def * conversionFactors.K_TO_K2O;
            let content = key==='N' ? fert.N : key==='P' ? fert.P : fert.K;
            const frac = (content || 0) / 100;
            if (!frac) return 0;
            const eff = fert.efficiency || 1;
            return required / (frac * eff);
          }
          const doseN = computeDose(defN, 'N');
          const doseP = computeDose(defP, 'P');
          const doseK = computeDose(defK, 'K');
          let resultHtml = `
            <h3>Resultados para ${cropKey.charAt(0).toUpperCase() + cropKey.slice(1)}</h3>
            <p><strong>Condición del año:</strong> ${yearKey.charAt(0).toUpperCase() + yearKey.slice(1)}</p>
            <p><strong>Recomendaciones ajustadas (N-P-K):</strong> ${formatNumber(recN)} - ${formatNumber(recP)} - ${formatNumber(recK)}</p>
            <p><strong>Valores medidos (N-P-K):</strong> ${formatNumber(nVal)} - ${formatNumber(pVal)} - ${formatNumber(kVal)}</p>
            <p><strong>Deficiencia estimada:</strong></p>
            <ul>
              <li>Nitrógeno (N): ${formatNumber(defN)}</li>
              <li>Fósforo (P): ${formatNumber(defP)}</li>
              <li>Potasio (K): ${formatNumber(defK)}</li>
            </ul>
          `;
          const fertRows = Object.keys(fertilizers).map(k=>{
            const f = fertilizers[k];
            const comps = [];
            if (f.N) comps.push(\`N: \${f.N}%\`);
            if (f.P) comps.push(\`P₂O₅: \${f.P}%\`);
            if (f.K) comps.push(\`K₂O: \${f.K}%\`);
            if (f.S) comps.push(\`S: \${f.S}%\`);
            if (f.Ca) comps.push(\`Ca: \${f.Ca}%\`);
            if (f.Zn) comps.push(\`Zn: \${f.Zn}%\`);
            const eff = (f.efficiency*100).toFixed(0) + '%';
            return \`<tr><td>\${f.name}</td><td>\${comps.join(', ')}</td><td>\${eff}</td></tr>\`;
          }).join('');
          const fertTableHtml = `
            <h3>Eficiencia de fertilizantes principales</h3>
            <table class="fertilizer-table">
              <thead><tr><th>Fertilizante</th><th>Composición aproximada</th><th>Eficiencia</th></tr></thead>
              <tbody>${fertRows}</tbody>
            </table>`;
          const fertRecommendationHtml = `
            <h3>Recomendación de fertilizantes y dosis</h3>
            <ul>
              <li>Nitrógeno (N): ${doseN>0 ? \`aplicar \${defaultFertilizerFor.N.name} – dosis aprox. \${formatNumber(doseN)}\` : 'no se requiere'}</li>
              <li>Fósforo (P): ${doseP>0 ? \`aplicar \${defaultFertilizerFor.P.name} – dosis aprox. \${formatNumber(doseP)}\` : 'no se requiere'}</li>
              <li>Potasio (K): ${doseK>0 ? \`aplicar \${defaultFertilizerFor.K.name} – dosis aprox. \${formatNumber(doseK)}\` : 'no se requiere'}</li>
            </ul>`;
          resultContainer.innerHTML = resultHtml + fertRecommendationHtml + fertTableHtml;
          resultContainer.style.display = 'block';
          window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        } catch (err) {
          console.error(err);
          alert('Ocurrió un error inesperado. Probá recargar la página.');
        }
      });
    </script>
  </body>
</html>
